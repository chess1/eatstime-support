<!--<!DOCTYPE html>-->
<!--<html lang="en">-->
<!--<head>-->
<!--<meta charset="UTF-8">-->
<!--<title>Eatstime support</title>-->
<!--</head>-->
<!--<body>-->
<!--<h1>Welcome to Eatstime support page</h1>-->
<!--<form id="support" action="/support" method="post">-->
<!--<div>-->
<!--Name: <input type="text" name="name"/>-->
<!--<br>-->

<!--Email: <input type="text" name="email"/>-->
<!--<br>-->

<!--Content: <input type="text" name="content"/>-->
<!--<br><br>-->
<!--</div>-->

<!--<input type="submit" name="submit" value="Submit"/>-->
<!--</form>-->

<!--</body>-->
<!--</html>-->

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Ajax contact form</title>
    <link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
<div class="jumbotron">
    <div class="container">
        <h1>EatsTime Support</h1>
        <!--<p>A simple ajax based contact form using pure JavaScript and PHP.</p>-->
    </div>
</div>

<div class="col-md-6 col-md-offset-3">
    <form novalidate enctype="application/x-www-form-urlencoded;" id="contact-form" class="form-horizontal" role="form"
          method="post">
        <div class="form-group">
            <label for="form-name" class="col-lg-2 control-label">Fullname</label>
            <div class="col-lg-10" id="name-field">
                <input type="text" class="form-control" id="form-name" name="form-name">
            </div>
        </div>
        <div class="form-group">
            <label for="form-email" class="col-lg-2 control-label">Email</label>
            <div class="col-lg-10" id="email-field">
                <input type="email" class="form-control" id="form-email" name="form-email">
            </div>
        </div>
        <div class="form-group">
            <label for="form-message" class="col-lg-2 control-label">Feedback</label>
            <div class="col-lg-10" id="message-field">
                <textarea class="form-control" rows="6" id="form-message" name="form-message"></textarea>
            </div>
        </div>
        <div class="form-group">
            <div class="col-lg-offset-2 col-lg-10">
                <button type="submit" class="btn btn-default">Send</button>
            </div>
        </div>
    </form>
</div>

<script type="text/javascript">
    var ContactForm = function (form, options) {
        if (!this || !(this instanceof ContactForm)) {
            return new ContactForm(form, options);
        }

        if (!form || !options) {
            return;
        }

        this.form = form instanceof Node ? form : document.querySelector(form);
        this.endpoint = options.endpoint;

        this.send();
    };

    ContactForm.prototype = {
        hasClass: function (el, name) {
            return new RegExp('(\\s|^)' + name + '(\\s|$)').test(el.className);
        },
        addClass: function (el, name) {
            if (!this.hasClass(el, name)) {
                el.className += (el.className ? ' ' : '') + name;
            }
        },
        removeClass: function (el, name) {
            if (this.hasClass(el, name)) {
                el.className = el.className.replace(new RegExp('(\\s|^)' + name + '(\\s|$)'), ' ').replace(/^\s+|\s+$/g, '');
            }
        },
        each: function (collection, iterator) {
            var i, len;

            for (i = 0, len = collection.length; i < len; i += 1) {
                iterator(collection[i], i, collection);
            }
        },
        template: function (string, data) {
            var piece;

            for (piece in data) {
                if (Object.prototype.hasOwnProperty.call(data, piece)) {
                    string = string.replace(new RegExp('{' + piece + '}', 'g'), data[piece]);
                }
            }

            return string;
        },
        empty: function (el) {
            while (el.firstChild) {
                el.removeChild(el.firstChild);
            }
        },
        removeElementsByClass: function (className) {
            var elements = document.getElementsByClassName(className);

            while (elements.length > 0) {
                elements[0].parentNode.removeChild(elements[0]);
            }
        },
        post: function (path, data, success, fail) {
            var xhttp = new XMLHttpRequest();

            xhttp.open('POST', path, true);
            xhttp.setRequestHeader('X-Requested-With', 'XMLHttpRequest');
            xhttp.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded; charset=UTF-8');
            xhttp.onreadystatechange = function () {
                if (this.readyState === 4) {
                    if (this.status === 200) {
                        var response = '';
                        try {
                            response = JSON.parse(this.responseText);
                        }
                        catch (err) {
                            response = this.responseText;
                        }
                        success.call(this, response);
                    }
                    else {
                        fail.call(this, this.responseText);
                    }
                }
            };
            xhttp.send(data);
            xhttp = null;
        },
        param: function (data) {
            var params = typeof data === 'string' ? data : Object.keys(data).map(
                                                      function (k) {
                                                          return encodeURIComponent(k) + '=' + encodeURIComponent(data[k]);
                                                      }
                                                  ).join('&');

            return params;
        },
        send: function () {
            this.form.addEventListener('submit', function (e) {
                e.preventDefault();

                var elements = document.querySelectorAll('.form-control'),
                    formData;

                this.each(elements, function (el, i) {
                    if (this.hasClass(el.parentNode, 'has-error')) {
                        this.removeClass(el.parentNode, 'has-error');
                        this.removeElementsByClass('help-block');
                    }
                }.bind(this));

                formData = {
                    'name': document.querySelector('input[name="form-name"]').value,
                    'email': document.querySelector('input[name="form-email"]').value,
                    'message': document.querySelector('textarea[name="form-message"]').value
                };

                const self = this;

                function validateFormData(data) {
                    let valid = true;

                    if (!/^[a-zA-Z0-9]+(?:\.[a-zA-Z0-9]+)*@(?:[a-zA-Z0-9](?:[a-zA-Z0-9-]*[a-zA-Z0-9])?\.)+[a-zA-Z0-9](?:[a-zA-Z0-9-]*[a-zA-Z0-9])?$/.test(data.email)) {
                        self.addClass(document.getElementById('email-field'), 'has-error');
                        valid = false;
                    } else {
                        self.removeClass(document.getElementById('email-field'), 'has-error');
                    }

                    if (!/^[a-zA-Z]/.test(data.name)) {
                        self.addClass(document.getElementById('name-field'), 'has-error');
                        valid = false;
                    }else {
                        self.removeClass(document.getElementById('name-field'), 'has-error');
                    }

                    if (data.message.length < 3) {
                        self.addClass(document.getElementById('message-field'), 'has-error');
                        valid = false;
                    }else {
                        self.removeClass(document.getElementById('message-field'), 'has-error');
                    }

                    return valid;
                }

                validateFormData(formData) && this.post(this.endpoint, this.param(formData), this.feedback.bind(this), this.fail.bind(this));
            }.bind(this), false);
        },
        feedback: function (data) {
            if (!data.success) {
                if (data.errors.name) {
                    var name = document.querySelector('input[name="form-name"]').parentNode,
                        error;

                    this.addClass(name, 'has-error');
                    error = this.template(
                        '<span class="help-block">{report}</span>', {
                            report: data.errors.name
                        });

                    name.insertAdjacentHTML('beforeend', error);
                }

                if (data.errors.email) {
                    var email = document.querySelector('input[name="form-email"]').parentNode,
                        error;

                    this.addClass(email, 'has-error');
                    error = this.template(
                        '<span class="help-block">{report}</span>', {
                            report: data.errors.email
                        });

                    email.insertAdjacentHTML('beforeend', error);
                }

                if (data.errors.message) {
                    var message = document.querySelector('textarea[name="form-message"]').parentNode,
                        error;

                    this.addClass(message, 'has-error');
                    error = this.template(
                        '<span class="help-block">{report}</span>', {
                            report: data.errors.message
                        });

                    message.insertAdjacentHTML('beforeend', error);
                }
            }
            else {
                var success = this.template(
                    '<div class="alert alert-success">{report}</div>', {
                        report: data.message
                    });

                this.empty(this.form);
                this.form.insertAdjacentHTML('beforeend', success);
            }
        },
        fail: function (data) {
            console.log(data);
        }
    };


    new ContactForm('#contact-form', {
        endpoint: '/support'
    });
</script>
</body>
</html>

